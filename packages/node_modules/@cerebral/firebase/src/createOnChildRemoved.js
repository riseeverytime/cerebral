import { listenTo, createRef } from './helpers'

export default function createOnChildRemoved(context) {
  return (path, signal, options = {}) => {
    listenTo(createRef(path, options), path, 'child_removed', signal, data => {
      context.controller.getSignal(signal)(
        Object.assign(
          {
            key: data.key,
          },
          options.payload
        )
      )
    })
  }
}
