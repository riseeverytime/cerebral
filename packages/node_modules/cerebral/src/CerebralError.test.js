/* eslint-env mocha */
import { CerebralError } from './'
import assert from 'assert'

describe('CerebralError', () => {
  it('should be able to extend error', () => {
    const MyError = class MyError extends CerebralError {}

    assert.ok(new MyError() instanceof Error)
  })
  it('should be able to instance of CerebralError', () => {
    const MyError = class MyError extends CerebralError {}

    assert.ok(new MyError() instanceof CerebralError)
  })
  it('should set name', () => {
    const MyError = class MyError extends CerebralError {}
    const error = new MyError()
    assert.strictEqual(error.name, 'CerebralError')
  })
  it('should set message', () => {
    const MyError = class MyError extends CerebralError {}
    const error = new MyError('hello')
    assert.strictEqual(error.message, 'hello')
  })
  it('should have stacktrace if thrown', () => {
    const MyError = class MyError extends CerebralError {}
    try {
      throw new MyError()
    } catch (e) {
      assert.ok(e instanceof Error)
      assert.ok(e.stack)
    }
  })
  it('should serialize', () => {
    const MyError = class MyError extends CerebralError {}
    try {
      throw new MyError('wuuut?', { foo: 'bar' })
    } catch (e) {
      const serialized = JSON.parse(JSON.stringify(e))

      assert.strictEqual(serialized.name, 'CerebralError')
      assert.strictEqual(serialized.message, 'wuuut?')
      assert.deepStrictEqual(serialized.details, { foo: 'bar' })
      assert.ok(serialized.stack)
    }
  })
  it('should auto extend toJSON with additional props', () => {
    const MyError = class MyError extends CerebralError {
      constructor(message, code) {
        super(message)
        this.name = 'MyError'
        this.code = code
      }
    }
    try {
      throw new MyError('wuuut?', 200)
    } catch (e) {
      const serialized = JSON.parse(JSON.stringify(e))

      assert.strictEqual(serialized.name, 'MyError')
      assert.strictEqual(serialized.message, 'wuuut?')
      assert.deepStrictEqual(serialized.code, 200)
      assert.ok(serialized.stack)
    }
  })
})
